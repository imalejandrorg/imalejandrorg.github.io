---
title: "Análisis de Varianza"
author: "Alejandro Ruiz-García"
date: "16/3/2021"
output:
  bookdown::html_document2:
    fig.caption: yes
---

```{r include=FALSE}
library(knitr)
library(bookdown)
library(vegan)
library(tidyverse)
library(kableExtra)
library(knitr)
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE, fig.align = "center")
```

# Histogramas y gráficos de densidad
Un **histograma** es una representación de la distribución de datos de una variable numérica. Un histograma nos puede mostrar la forma de la distribución de los datos de nuestra variable. Las áreas dentro de un histograma corresponden a las frecuencias de dichas clases.

De igual manera, la forma de un histograma puede ser muy útil al momento de interpretar datos. Se dice que un histograma es *unimodal* cuando solamente se aprecia un pico máximo en los datos y *bimodal* cuando se observan dos. Además un histograma puede estar *sesgado* cuando los datos se cargan hacia uno de los extremos. Se dice que un histograma está *sesgado hacia la izquierda* cuando la el modo (pico) esta cargado a la derecha, dejando una cola larga hacia la izquierda y que está *sesgado hacia la derecha* cuando ocurre lo contrario. Podemos ver en la figura \@ref(fig:histdist) los distintos tipos de distribuciones que se pueden formar si trazamos una línea sobre los histogramas, tomado de @Samuels2016.

```{r histdist, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.align = "center", fig.cap = "Formas de distribución."}
knitr::include_graphics("distributions.png", dpi = 120)
```

Una **curva de densidad** es una forma de representar la distribución de frecuencias de variables continuas, generalmente con una línea curva. El eje de las abscisas generalmente está representado por una escala llamada *escala de densidad*. Cuando esto es así, las frecuencias relativas están representadas como el *área debajo de la curva*. El área total debajo de la curva debe ser igual a 1.

## R y `ggplot2`
En esta sección aprenderemos a utilizar las herramientas incluidas en R para la elaboración de histogramas y gráficos de densidad. Sin embargo, también utilizaremos una librería que nos permitirá visualizar mejor los datos llamada `gplot2`.


### Histogramas y gráficos de densidad en R
En esta ocasión utilizaremos la base de datos `mtcars` que viene incluida en el paquete `ggplot2`. 
```{r}
library(ggplot2)
data(mtcars)
```

Para crear un histograma con las herramientas básicas de R simplemente escribimos el siguiente código. El argumento `prob = TRUE` hace que la abscisa (y) este representado por una escala de densidad en lugar de los valores de las variables.
```{r echo=TRUE, fig.align = "center", fig.cap = "Histograma de la matriz de datos `mtcars`. El eje de la x representa las millas por galón y el eje y repesenta la escala de densidad."}
hist(mtcars$mpg, prob = TRUE)
```

En caso de que queramos hacer un gráfico de densidad en lugar de un histograma podemos utilizar el siguiente código. La función `density()` nos muestra la información acerca de la distribución de los datos. Para ver el gráfico debemos utilizar la función `plot()`. 
```{r fig.align = "center", fig.cap = "Gráfico de densidad de la matriz de datos `mtcars`. El eje de la x representa las millas por galón y el eje y repesenta la escala de densidad."}
plot(density(mtcars$mpg))
```

Podemos visualizar tanto el histograma como la línea de densidad en el mismo gráfico. Para esto graficamos el histograma de manera normal con la función `hist()` pero después de esto utilizamos la función `lines()`.
```{r fig.cap = "Histograma y gráfico de densidad de la matriz de datos `mtcars`."}
hist(mtcars$mpg, prob = TRUE)
lines(density(mtcars$mpg), col = "blue")
```

### Histogramas y gráficos de densidad en `ggplot2`
Como ya hemos cargado `ggplot2` en el ejemplo anterior para poder importar la base de datos, no es necesario volver a cargarlo. Empecemos entonces con el gráfico más básico de nuestros datos utilizando las funciones `ggplot()` y `geom_density()`.
```{r fig.cap = "Gráfico de densidad utilizando `ggplot2`."}
ggplot(mtcars, aes(x = mpg)) + 
  geom_density()
```

Podemos agregar etiquetas a los valores de *x* y *y*.
```{r fig.cap = "Gráfico de densidad utilizando `ggplot2` con las etiquetas modificadas."}
ggplot(mtcars, aes(x = mpg)) + 
  geom_density() +
  labs(x = "Milas por galón", y = "Densidad")
```

Además podemos rellenar el área debajo de la curva con el argumento `fill`.
```{r fig.cap = "Gráfico de densidad utilizando `ggplot2` con el área bajo la curva rellena."}
ggplot(mtcars, aes(x = mpg)) + 
  geom_density(fill = "lightblue") +
  labs(x = "Milas por galón", y = "Densidad")
```

Adicionalmente podemos modificar la transparencia con el argumento `alpha`.
```{r fig.cap = "Gráfico de densidad utilizando `ggplot2` relleno y con transparencia modificada."}
ggplot(mtcars, aes(x = mpg)) + 
  geom_density(fill = "lightblue", alpha = 0.5) +
  labs(x = "Milas por galón", y = "Densidad")
```

De igual manera, podemos indicar la posición de la media en este gráfico. Primero debemos de caluclar la media con la función `mean()`.
```{r}
mpg.mean <- mean(mtcars$mpg)
```

Una vez calculada la media, podemos utilizar otra función llamada `geom_vline` en el gráfico que ya habíamos creado.
```{r fig.cap = "Gráfico de densidad utilizando `ggplot2` en donde se indica la media."}
ggplot(mtcars, aes(x = mpg)) + 
  geom_density(fill = "lightblue", alpha = 0.5) +
  labs(x = "Milas por galón", y = "Densidad") +
  geom_vline(xintercept = mpg.mean, size = 1, color = "red", linetype = "solid")
```

Adicionalmente podemos explorar distintos temas que `ggplot2` ofrece.

```{r fig.cap = "Gráfico de densidad utilizando `ggplot2` modificando los temas.."}
ggplot(mtcars, aes(x = mpg)) + 
  geom_density(fill = "lightblue", alpha = 0.5) +
  labs(x = "Milas por galón", y = "Densidad") +
  geom_vline(xintercept = mpg.mean, size = 1, color = "red", linetype = "solid") +
  theme_classic()
```
